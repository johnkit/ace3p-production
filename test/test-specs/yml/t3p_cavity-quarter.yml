name: t3p_cavity-quarter

steps:
  - title:  Setup and create yyyy-mm-dd directory
    action: Complete setup items if directed in the gitlab issue.

  - title:  Clone ace3p-extensions repository
    action: Make sure you have clone the ace3p-extensions repository, either https://gitlab.kitware.com/cmb/plugins/ace3p-extensions.git or git@gitlab.kitware.com:cmb/plugins/ace3p-extensions.git, and are using the current master branch.

    # Todo add action
  - title: Maximize screen, Load project plugin, pull sidebar to 1/3 screen width
    action: Todo

  - title:  New project
    action: Select the "Project" => "New Project..." menu item.
    expect: modelbuilder to open a directory browser dialog

  - title:  New project directory yyyy-mm-dd/t3p_cavity-quarter.
    action: In that dialog, navigate to the test directory you created in the setup procedure and create a subdirectory <tt>t3p_cavity-quarter</tt>. Select the new subdirectory and click the OK.
    expect: modelbuilder to display a "Specify New Project" dialog with the "Workspace Directory" and "Name (Subdirectory)" fields set.

  - title:  Simulation template "ACE3P.sbt"
    action: Set the "Simulation Template File" to the ACE3P template that is in the ace3p-extensions repository at <tt>simulation-workflows/ACE3P.sbt</tt>.

  - title:  Geometry model "pillboxwg.ncdf"
    action: Set the "Geometry File" to <tt>data/model/3d/netcdf/pillboxwg.ncdf</tt>. You will need to set the extension dropdown to "netcdf".

  - title:  Apply
    action: Click the "Apply" button.
    expect: modelbuilder to close the dialog, then display the model geometry in the 3D view and update the Attribute Editor to display a "Modules" tab. On some systems, the model is not immediately displayed, but instead it appears when the "Resources" tab is selected. If that occurs, add a comment to the GitLab issue. Verify that there are two items listed in the "Resources" panel, labeled <tt>sbi.default</tt> and <tt>pillboxwg</tt>.

  - title: Save Project
    action: Select "Project" => "Save Project" menu item.
    expect: modelbuilder "Output Messages" view to include "Saved Project".


    # Play or record test script
  - begin:  record/play
    title:  Begin record/play t3p_cavity-quarter.xml
    action: |
      <li>Select whether to record or play the test. In general, you should select PLAY if the xml file is available.</li>
      <li>If you select PLAY, use the "Tools" => "Play Test..." menu item and navigate to the "t3p_cavity-quarter.xml" file.</li>
      <li>If you select RECORD, use the "Tools" => "Record Test..." menu and specify "t3p_cavity-quarter.xml" as the file.</li>

  - title: Select T3P module
    action: In the Attribute Editor "Modules" tab, select "T3P".
    expect: Six tabs should appear in the Attribute Editor, labeled "Boundary Conditions", "Materials", "Analysis", "Beam Info", "Loading", and "Monitors".

  - title: Boundary Conditions
    action: |
      Select the "Boundary Condition" tab, then
      <ol>
        <li>Set surface 1 and 2 to Magnetic</li>
        <li>Set surface 3 and 4 to Absorbing</li>
        <li>Set surface 5 and 6 tp Exterior</li>
      </ol> 
  
  - title: Analysis
    action: |
      Select the "Analysis" tab, then
      <ol>
        <li>Change the "Linear Solver" dropdown to "MUMPS"</li>
        <li>Set the "Maximum Time (s)"" to 5e-09</li>
        <li>Set "Time Steps (s)"" to 2e-12</li>
      </ol> 

  - title: Beam Info
    action: |
      Select the "Beam Info" tab, then
      <ol>
        <li>Click on the "New" button to create an attribute.</li>
        <li>In the editor section, set the "Bunch Type" to "Gaussian".</li>
        <li>(In the subpanel just beneath "Gaussian") Set "RMS Bunch Length (m)" to 0.01.</li>
        <li>Set "Number of Sigmas" to 5.</li>
        <li>Set the "Symmetry Factor" to 4.</li>
        <li>Set the "Charge (C)" to 1.0e-12.</li>
        <li>Set the "Starting Point (m)" to 0, 0, -0.075</li>
        <li>Set the "Source Boundary" to "surface 3"</li>
      </ol> 
  
  - title: Monitor settings
    action: |
      Select the "Monitor" tab, then
      <ol>
        <li>Set the drop down menu to "Volume Monitor".</li>
        <li>Click the "New" button to create attribute.</li>
        <li>In the editor pane, the "Name" field should be blank and red - set it to "mymon"</li>
        <li>Set "Start Time (s)" to 0, "End Time (s)"" to 5e-09, and "Time Interval" to 1e-10.</li>
      </ol>
     
      In the same tab, change the drop down to "Wakefield Monitor" and click "New".
      
      <ol>
        <li>Set the "Name" field to "wakefield"</li>
        <li>Set "Start Contour" to -0.075. "End Contour" to 0.075, "Max Distance" to 1.4.</li>
      </ol>

      In the same tab change the drop down to "Power Monitor" and click "New".

      <ol>
        <li>Set the "Name" field to "power-monitor".</li>
        <li>Set the "Monitor Boundary" to "surface 5"</li>
      </ol>

      In the same tab, change the drop down to "Mode Voltage Monitor" and click "New".
      
      <ol> 
        <li>Set the "Name" field to "mode-voltage".</li>
        <li>Set the "Monitor Port" to "surface 6".</li>
      </ol

  - title:  Save Project
    action: From the "Project" menu, select "Save Project".
    expect: modelbuilder "Output Messages" to include "Saved Project".

  - end:    record/play
    title:  Finish record/play
    action: If you are recording the test, click the "Stop Recording" button to save the xml script.
    # End record/play

  - title: Export
    action: |
      From the "Project" menu
      <ol>
        <li>Select "Export Project" to open the "Simulation Export Dialog".</li>
        <li>Click the "Apply" button. Expect the dialog to close.</li>
      </ol>
    expect: modelbuilder generated the file "t3_cavity-quarter.t3p".

  - title:  Close Project
    action: Select the Project => Close Project menu item.
    expect: modelbuilder to clear both tabs ("Attribute Editor", "Resources") and the 3D display.
