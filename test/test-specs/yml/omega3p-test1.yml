name: Omega3P Test 1

steps:
  - title:  Setup and create yyyy-mm-dd directory.
    action: Complete the setup procedures first, including creating a new directory for test files.

  - title:  Clone ace3p-extensions repository
    action: |
      Clone the ace3p-extensions repository, either
      <a class="literal-link" target="_blank" href="https://gitlab.kitware.com/cmb/plugins/ace3p-extensions.git"></a>
      or <a class="literal-link" target="_blank" href="git@gitlab.kitware.com:cmb/plugins/ace3p-extensions.git"></a>.

  - title:  New project
    action: Select Project => New Project...
    expect: modelbuilder to open a directory browser dialog

  - title:  New project directory
    action: In that dialog, navigate to the test directory you created in the setup procedure and create a subdirectory <strong>yyyy-mm-dd/omega3p-test1</strong>. Select the new subdirectory and click the OK.
    expect: modelbuilder to display a "Specify New Project" dialog with the "Workspace Directory" and "Name (Subdirectory)" fields set.

  - title:  Simulation template "ACE3P.sbt"
    action: Set the "Simulation Template File" to the ACE3P template that is in the ace3p-extensions repository at <tt>simulation-workflows/ACE3P.sbt</tt>.

  - title:  Geometry model "pillbox4.gen"
    action: Set the "Geometry File" to <tt>data/model/3d/genesis/pillbox4.gen</tt>.

  - title:  Apply
    action: Click the "Apply" button.
    expect: modelbuilder to close the dialog, then display the model geometry in the 3D view and update the Attribute Editor to display a "Modules" tab. On some systems, the model is not immediately displayed, but instead it appears when the "Resources" tab is selected. If that occurs, add a comment to the GitLab issue. Verify that there are two items listed in the "Resources" panel, labeled <tt>sbi.default</tt> and <tt>pillbox4</tt>.


    # Play or record test script
  - begin:  record/play
    title:  Begin record/play omega3p-test1.xml
    action: |
      <li>Select whether to record or play the test. In general, you should select PLAY if the xml file is available.</li>
      <li>If you select PLAY, use the "Tools" => "Play Test..." menu item and navigate to the "omega3p-test1.xml" file.</li>
      <li>If you select RECORD, use the "Tools" => "Record Test..." menu and specify "omega3p-test1.xml" as the file.</li>

  - title:  Set Omega3P module
    action: In the "Attribute Editor" panel, select the "Omega3P" option in the "Modules" tab.
    expect: modelbuilder to display 3 additional tabs "Boundary Conditions", "Materials", and "Analysis".

  - title:  Set Boundary Conditions
    action: |
      In the "Boundary Conditions" panel:
      <ol>
        <li>Set "Unnamed set ID: 1" to "Magnetic".</li>
        <li>Set "Unnamed set ID: 2" to "Magnetic".</li>
        <li>Set "Unnamed set ID: 6" to "Exterior".</li>
      </ol>

  - title:  Set Analysis options
    action: In the "Analysis" tab, set "Number of eigenmodes searched" to 3.
    expect: background color of that field to change from yellow to white.

  - title:  Save Project
    action: Click the Project => Project Save menu item.
    expect: modelbuilder to display "Saved project" in the "Output Messages" panel.

  - end:    record/play
    title:  Finish record/play
    action: If you are recording the test, click the "Stop Recording" button to save the xml script.
    # End record/play


  - title:  Begin Export Project
    action: Select the Project => Export Project menu item.
    expect: modelbuilder to open a "Simulation Export Dialog" with every field set and the "Apply" button enabled.

  - title:  Apply Export
    action: Click the "Apply" button.
    expect: |
      modelbuilder to close the dialog and write a few lines to the "Output Messages" panel, the last one <tt>Number of warnings: 0</tt>.

  - title:  Verify Result
    action: Verify that a short text file was created in a project subdirectory <tt>omega3p-test1/export</tt> with an extension <tt>omega3p</tt>.

  - title:  Close Project
    action: Select the Project => Close Project menu item.
    expect: modelbuilder to clear both tabs ("Attribute Editor", "Resources") and the 3D display.

  - title:  Report
    action: Add note to GitLab issue that test was completed.
