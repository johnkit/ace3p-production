name: t3p_cavity-quarter

steps:
  - title:  Setup
    action: Complete the setup procedures first.

  - title:  Clone ace3p-extensions repository
    action: |
      Clone the ace3p-extensions repository, either
      <a class="literal-link" target="_blank" href="https://gitlab.kitware.com/cmb/plugins/ace3p-extensions.git"></a>
      or <a class="literal-link" target="_blank" href="git@gitlab.kitware.com:cmb/plugins/ace3p-extensions.git"></a>.

  - title:  New project
    action: Select Project => New Project...
    expect: modelbuilder to open a directory browser dialog

  - title:  New project directory
    action: In that dialog, navigate to the test directory you created in the setup procedure and create a subdirectory `t3p_cavity-quarter`. Select the new subdirectory and click the `OK`.
    expect: modelbuilder to display a "Specify New Project" dialog with the "Workspace Directory" and "Name (Subdirectory)" fields set.

  - title:  Simulation template "ACE3P.sbt"
    action: Set the "Simulation Template File" to the ACE3P template that is in the ace3p-extensions repository at `simulation-workflows/ACE3P.sbt`.

  - title:  Geometry model "pillboxwg.ncdf"
    action: Set the "Geometry File" to `data/model/3d/netcdf/pillboxwg.ncdf`. You will need to set the extension dropdown to "netcdf".

  - title:  Apply
    action: Click the "Apply" button.
    expect: modelbuilder to close the dialog, then display the model geometry in the 3D view and update the Attribute Editor to display a "Modules" tab. On some systems, the model is not immediately displayed, but instead it appears when the "Resources" tab is selected. If that occurs, add a comment to the GitLab issue. Verify that there are two items listed in the "Resources" panel, labeled `sbi.default` and `pillboxwg`.

  - title: Save Project
    action: Select Project => Save Project
    expect: modelbuilder Output Messages to include "Saved Project".

  - title: Set T3P
    action: In the Attribute Editor select the "Modules" tab and select "T3P" as the module in the drop down menu.
    expect: Six tabs should appear in the attribute editor labeled Boundary Conditions, Materials, Analysis, Beam Info, Loading, and Monitors.

  - title: Setting Boundary Conditions
    action: |
      In the "Boundary Condition" tab
      <ol>
        <li>Set surface 1 and 2 = Magnetic</li>
        <li>Set surface 3 and 4 = Absorbing</li>
        <li>Set surface 5 and 6 = Exterior</li>
      </ol> 
  
  - title: Analysis Settings
    action: |
      In the "Analysis" tab
      <ol>
        <li>Change the "Liner Solver" dropdown to "MUMPS"</li>
        <li>Set the max time to 5e-09</li>
        <li>Set time steps to 2e-12</li>
      </ol> 

  - title: Beam Info Settings
    action: |
      In the "Beam Info" tab
      <ol>
        <li>Click on the "new" button</li>
        <li>Set the name to "BeamLoading"</li>
        <li>Set the bunch type to "Gaussian"</li>
        <li>Enter 0.01 as the RMS Bunch Legion and 5 as the number of legions</li>
        <li>Set the symmetry factor to 4</li>
        <li>Set the charge to 1.0e-12</li>
        <li>Set the start point to 0, 0, -0.075 respectively </li>
        <li>Set the source boundary to surface 3</li>
      </ol> 
  
  - title: Monitor settings
    action: |
      In the "Monitor" tab
      <ol>
        <li>Set the drop down menu to "Volume"</li>
        <li>Click on the "new" button and click enter</li>
        <li>The "Name" box should be blank and red - make the name "mymon"</li>
        <li>Set the Start time to 0, End time to 5e-09, and the Interval to 1e-10</li>
      </ol>
     
        In the same tab change the drop down to "Wakefield" click "new" and the enter
      
      <ol>
        <li>The "Name" box should be blank and red - make the name "wakefield"</li>
        <li>Set Start contour to -0.075 and End contour to 0.075 with a Max distance of 1.4
      </ol>

      In the same tab change the drop down to "Power" click "new" and the enter

      <ol>
        <li>The "Name" box should be blank and red - make the name "power-monitor"</li>
        <li>Set the monitor boundary to surface 5</li>
      </ol>

      In the same tab change the drop down to "Voltage" click "new" and the enter
      
      <ol> 
        <li>The "Name" box should be blank and red - make the name "mode-voltage"</li>
        <li>Set the monitor port to surface 6</li>
      </ol>
  - title: Saving
    action: Save, export, and verify that the .t3p file has been generated. 
