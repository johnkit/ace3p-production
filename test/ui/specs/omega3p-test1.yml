name: Omega3P Test 1

steps:
  - title:  Setup
    action: Complete the setup procedures first.

  - title:  Clone ace3p-extensions repository
    action: |
      Clone the ace3p-extensions repository, either
      <a class="literal-link" target="_blank" href="https://gitlab.kitware.com/cmb/plugins/ace3p-extensions.git"></a>
      or <a class="literal-link" target="_blank" href="git@gitlab.kitware.com:cmb/plugins/ace3p-extensions.git"></a>.

  - title:  New project
    action: Select Project => New Project...
    expect: modelbuilder to open a directory browser dialog

  - title:  New project directory
    action: In that dialog, navigate to the test directory you created in the setup procedure and create a subdirectory `omega3p-test1`. Select the new subdirectory and click the `OK`.
    expect: modelbuilder to display a "Specify New Project" dialog with the "Workspace Directory" and "Name (Subdirectory)" fields set.

  - title:  Simulation template "ACE3P.sbt"
    action: Set the "Simulation Template File" to the ACE3P template that is in the ace3p-extensions repository at `simulation-workflows/ACE3P.sbt`.

  - title:  Geometry model "pillbox4.gen"
    action: Set the "Geometry File" to `data/model/3d/genesis/pillbox4.gen`.

  - title:  Apply
    action: Click the "Apply" button.
    expect: modelbuilder to close the dialog, then display the model geometry in the 3D view and update the Attribute Editor to display a "Modules" tab. On some systems, the model is not immediately displayed, but instead it appears when the "Resources" tab is selected. If that occurs, add a comment to the GitLab issue. Verify that there are two items listed in the "Resources" panel, labeled `sbi.default` and `pillbox4`.

  - title:  Set Omega3P module
    action: In the "Attribute Editor" panel, select the "Omega3P" option in the "Modules" tab.
    expect: modelbuilder to display 3 additional tabs "Boundary Conditions", "Materials", and "Analysis".

  - title:  Set Boundary Conditions
    action: |
      In the "Boundary Conditions" panel:
      <ol>
        <li>Set "Unnamed set ID: 1" to "Magnetic".
        <li>Set "Unnamed set ID: 2" to "Magnetic".
        <li>Set "Unnamed set ID: 6" to "Exterior".
      </ol>

  - title:  Set Analysis options
    action: In the "Analysis" tab, set "Number of eigenmodes searched" to 3.
    expect: background color of that field to change from yellow to white.

  - title:  Save Project
    action: Click the Project => Project Save menu item.
    expect: modelbuilder to display "Saved project" in the "Output Messages" panel.

  - title:  Begin Export Project
    action: Select the Project => Export Project menu item.
    expect: modelbuilder to open a "Simulation Export Dialog" with every field set and the "Apply" button enabled.

  - title:  Apply Export
    action: Click the "Apply" button.
    expect: |
      modelbuilder to close the dialog and write a few lines to the "Output Messages" panel, the last one <pre>Number of warnings: 0</pre>.

  - title:  Verify Result
    action: Verify that a short text file was created in a project subdirectory `omega3p-test1/export` with an extension `omega3p`.

  - title:  Close Project
    action: Select the Project => Close Project menu item.
    expect: modelbuilder to clear both tabs ("Attribute Editor", "Resources") and the 3D display.

  - title:  Report
    action: Add note to GitLab issue that test was completed.
